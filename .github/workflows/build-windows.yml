name: CMake Build (Windows x86-64)

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

env:
  BUILD_TYPE: Release

jobs:
  build:

    runs-on: windows-latest
    
    defaults:
      run:
        shell: msys2 {0}
    steps:
    - uses: actions/checkout@v1
    - uses: msys2/setup-msys2@v2
      with:
          msystem: MINGW64
          update: true
          pacboy: >-
            cc:p
            cmake:p
            mesa:p
            ninja:p
            SDL2:p
            qt5-static:p
            libslirp:p
            libarchive:p
            libepoxy:p

    - name: Configure
      run: >-
        cmake
        $GITHUB_WORKSPACE
        -G 'Ninja'
        -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}
        -DBUILD_STATIC=ON
        -DQT5_STATIC_DIR=C:/tools/msys64/mingw64/qt5-static
        -B build/
        -S ./

    - name: Build
      run: cmake --build build/

    - uses: actions/upload-artifact@v1
      with:
        name: melonDS-windows-x86_64
        path: ${{runner.workspace}}\melonDS\build\melonDS.exe
